// fil-app.js
import * as Filament from './filament.js'; // caminho para o seu filament.js

async function initFilament() {
    try {
        // Cria canvas
        const canvas = document.getElementById('filament-canvas');
        if (!canvas) {
            console.error("Canvas não encontrado!");
            return;
        }

        // Inicializa Filament
        const engine = await Filament.Engine.create();
        const scene = engine.createScene();
        const view = engine.createView();
        view.setScene(scene);

        const renderer = engine.createRenderer();
        const swapChain = engine.createSwapChain(canvas);

        // Loop de render
        function renderLoop() {
            if (!renderer.beginFrame(swapChain)) return;
            renderer.render(view);
            renderer.endFrame();
            requestAnimationFrame(renderLoop);
        }

        renderLoop();

        console.log("Filament iniciado com sucesso!");
    } catch (e) {
        console.error("Erro ao inicializar Filament:", e);
    }
}

// Espera o DOM carregar
window.addEventListener('DOMContentLoaded', initFilament);  scene.addEntity(boxEntity);

  // Loop de renderização com rotação
  let angle = 0;
  function render() {
    angle += 0.01;
    const tm = engine.getTransformManager();
    const inst = tm.getInstance(boxEntity);
    tm.setTransform(inst, Filament.mat4f.transpose(Filament.mat4f.rotation(angle, [0, 1, 0])));
    tm.commit();
    tm.destroy(inst);

    engine.beginFrame(swapChain);
    engine.render(view);
    engine.endFrame();

    requestAnimationFrame(render);
  }
  render();
});
